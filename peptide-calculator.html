<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–¢–∏—Ä–∑–µ–ø–∞—Ç–∏–¥ (–ú—É–Ω–¥–∂–∞—Ä–æ): –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è | Nefarma</title>

  <meta name="description" content="–ë—ã—Å—Ç—Ä—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–∑–≤–µ–¥–µ–Ω–∏—è –ø–µ–ø—Ç–∏–¥–∞ –¢–∏—Ä–∑–µ–ø–∞—Ç–∏–¥: –º–≥‚Üî–º–∫–≥, –º–ª‚ÜîU‚Äë100, –¥–æ–∑—ã, –∫—É—Ä—Å, —ç–∫—Å–ø–æ—Ä—Ç CSV. –¢—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞, –æ—Ñ–ª–∞–π–Ω-–¥–æ—Å—Ç—É–ø." />
  <meta property="og:title" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–µ–ø—Ç–∏–¥–æ–≤ Nefarma" />
  <meta property="og:description" content="–°—á–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é (–º–≥/–º–ª), –æ–±—ä—ë–º –∏–Ω—ä–µ–∫—Ü–∏–∏ (–º–ª, U‚Äë100) –∏ —á–∏—Å–ª–æ –¥–æ–∑. –ï—Å—Ç—å –ø—Ä–µ—Å–µ—Ç—ã, —ç–∫—Å–ø–æ—Ä—Ç, —à–∞—Ä–∏–Ω–≥ –≤ WhatsApp –∏ –æ—Ñ–ª–∞–π–Ω." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/og-card.jpg" />
  <meta property="og:locale" content="ru_RU" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap&subset=cyrillic" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap&subset=cyrillic">
  </noscript>

  <style>
    :root{
      --bg:#0f1012; --surf:#181a1f; --text:#f4f6f8; --muted:#aeb6c2;
      --primary:#00aaff; --primary-2:#0088cc; --warn:#ffc107; --ok:#19c37d; --border:#2a2f36;
      --r:14px; --shadow:0 8px 28px rgba(0,0,0,.25);
      --tap:48px; /* min tap target */
    }
    html[data-theme="light"]{
      --bg:#ffffff; --surf:#f6f7f9; --text:#0f1115; --muted:#4b5563; --border:#e5e7eb;
      --shadow:0 10px 24px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif; background:var(--bg); color:var(--text); line-height:1.6}

    /* Layout */
    .container{max-width:980px; margin:0 auto; padding: clamp(12px, 4vw, 24px)}
    header{position:sticky; top:0; z-index:40; background:rgba(15,16,18,.75); backdrop-filter:saturate(130%) blur(8px); border-bottom:1px solid var(--border)}
    html[data-theme="light"] header{background:rgba(255,255,255,.85)}
    .hdr{display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px; min-height:60px; padding:8px 12px}
    .logo{display:flex; align-items:center; gap:10px; color:inherit; text-decoration:none}
    .logo img{height:32px; width:auto}
    html[data-theme="light"] .logo img {filter: invert(1);}

    .row{display:flex; align-items:center; gap:10px}

    /* Responsive header buttons */
    @media (max-width: 640px) {
      .hdr .row {
        flex-basis: 100%;
        justify-content: flex-end;
      }
    }

    .card{background:var(--surf); border:1px solid var(--border); border-radius:var(--r); box-shadow:var(--shadow)}
    .section{padding: clamp(14px, 3.2vw, 22px)}
    h1{margin:8px 0 12px; font-size:clamp(22px, 6vw, 32px)}
    h2{margin:0 0 12px; font-size:clamp(18px, 5vw, 24px)}
    .muted{color:var(--muted)}

    /* Grid */
    .grid{display:grid; gap:14px}
    @media (min-width:780px){.grid-2{grid-template-columns:1fr 1fr}}

    /* Inputs */
    .label{display:block; font-weight:600; font-size:13px; color:#e7e7e7; margin-bottom:6px}
    html[data-theme="light"] .label{color:#2a2e35}
    .input{width:100%; background:#111318; color:var(--text); border:1px solid var(--border); border-radius:12px; padding:12px 14px; font-size:16px; min-height:var(--tap)}
    html[data-theme="light"] .input{background:#fff}
    .input:focus{outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(0,170,255,.25)}
    input[type=number]{appearance:textfield}
    input[type=number]::-webkit-outer-spin-button, input[type=number]::-webkit-inner-spin-button{appearance:none; margin:0}
    .seg{display:inline-flex; border:1px solid var(--border); border-radius:12px; overflow:hidden}
    .seg button{min-height:var(--tap); padding:8px 12px; background:transparent; color:var(--text); border:0; cursor:pointer; font-weight:600}
    .seg button[aria-pressed="true"]{background:var(--primary); color:#fff}
    html[data-theme="light"] .seg button[aria-pressed="true"]{color:#fff}

    /* Stats */
    .stats{display:grid; gap:10px; margin-top:10px}
    @media (min-width:680px){.stats{grid-template-columns:repeat(3,1fr)}}
    .stat{border:1px dashed var(--border); border-radius:12px; background:#0c0e12; padding:12px; position:relative}
    html[data-theme="light"] .stat{background:#fff}
    .stat .k{font-size:12px; color:var(--muted)}
    .stat .v{font-size:clamp(22px, 6vw, 28px); font-weight:800}
    .stat .u{font-size:14px; color:var(--muted); font-weight:600; margin-left:6px}
    .pulse{animation:pulse .9s ease}
    @keyframes pulse{from{box-shadow:0 0 0 0 rgba(0,170,255,.35)} to{box-shadow:0 0 0 10px rgba(0,170,255,0)}}

    /* Buttons */
    .btns{display:flex; flex-wrap:wrap; gap:10px; margin-top:10px}
    .btn{min-height:var(--tap); padding:10px 14px; border-radius:12px; border:1px solid var(--border); background:#0c0e12; color:var(--text); font-weight:700; cursor:pointer; text-decoration: none; display: inline-flex; align-items: center; justify-content: center;}
    html[data-theme="light"] .btn{background:var(--surf); color: var(--text);}
    .btn:hover{filter:brightness(1.05)}
    html[data-theme="light"] .btn:hover{filter:brightness(0.95)}
    .btn.primary{background:var(--primary); border-color:var(--primary); color:#fff}
    html[data-theme="light"] .btn.primary{color:#fff;}
    .btn.success{background:var(--ok); border-color:var(--ok); color:#0b1c14}
    html[data-theme="light"] .btn.success{color:#fff;}


    /* Accordion */
    .acc .item{border-top:1px solid var(--border)}
    .acc .head{width:100%; text-align:left; background:transparent; border:0; color:var(--text); padding:16px 0; font-weight:700; display:flex; align-items:center; justify-content:space-between; cursor:pointer; min-height:var(--tap)}
    .acc .icon{transition:transform .25s ease}
    .acc .body{max-height:0; overflow:hidden; transition:max-height .35s ease}
    .acc .inner{padding:0 2px 14px; color:var(--muted)}
    .acc .item.active .icon{transform:rotate(45deg)}

    /* Dock for mobile */
    .dock{position:sticky; bottom:0; z-index:30; padding:8px; margin-top:12px; background:linear-gradient(to top, rgba(0,0,0,.35), rgba(0,0,0,0))}
    html[data-theme="light"] .dock{background:linear-gradient(to top, rgba(255,255,255,.6), rgba(255,255,255,0))}
    .dock .bar{display:flex; gap:8px; background:#0f1117; border:1px solid var(--border); border-radius:14px; padding:8px}
    html[data-theme="light"] .dock .bar{background:#fff}
    .dock .bar .btn{flex:1}

    /* Alerts */
    .callout{margin-top:10px; padding:12px 14px; border-left:4px solid var(--warn); border-radius:8px; background:rgba(0,0,0,.25); color:var(--muted); font-size:14px}
    html[data-theme="light"] .callout{background:#fff6d1; color: #5d4c0c}

    /* History table */
    table{width:100%; border-collapse:separate; border-spacing:0; font-size:14px}
    th,td{padding:10px 12px; border-bottom:1px solid var(--border)}
    th{text-align:left; color:var(--muted); font-weight:700}

    /* Accessibility helpers */
    .sr{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <header>
    <div class="container hdr">
      <a class="logo" href="index.html" aria-label="–ù–∞ –≥–ª–∞–≤–Ω—É—é Nefarma">
        <img src="logo.webp" alt="Nefarma" width="128" height="32" />
      </a>
      <div class="row">
        <button id="install" class="btn" aria-label="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        <button id="theme" class="btn" aria-pressed="true" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
        <a class="btn" href="tel:+77780990459">+7 (778) 099‚Äë04‚Äë59</a>
      </div>
    </div>
  </header>

  <main class="container" id="app">
    <section class="card section" style="margin-bottom:10px">
      <h1>–¢–∏—Ä–∑–µ–ø–∞—Ç–∏–¥ (–ú—É–Ω–¥–∂–∞—Ä–æ): –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h1>
      <p class="muted">–ú–æ–±–∏–ª—å–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–∑–≤–µ–¥–µ–Ω–∏—è: –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è (–º–≥/–º–ª), —Ç–æ—á–Ω—ã–π –æ–±—ä—ë–º –Ω–∞–±–æ—Ä–∞ (–º–ª –∏ U‚Äë100), —á–∏—Å–ª–æ –¥–æ–∑ –∏–∑ —Ñ–ª–∞–∫–æ–Ω–∞. –ü—Ä–µ—Å–µ—Ç—ã, –∏—Å—Ç–æ—Ä–∏—è, —ç–∫—Å–ø–æ—Ä—Ç CSV/JSON, WhatsApp‚Äë—à–∞—Ä–∏–Ω–≥, –æ—Ñ–ª–∞–π–Ω‚Äë—Ä–µ–∂–∏–º.</p>
    </section>

    <section class="card section" style="margin-bottom:10px">
      <div class="grid grid-2">
        <div>
          <h2>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>
          <label class="label" for="vial">1) –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ —Ñ–ª–∞–∫–æ–Ω–µ</label>
          <div class="row">
            <input class="input" id="vial" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 5" min="0" step="0.01" aria-describedby="vial-help" />
            <div class="seg" role="group" aria-label="–ï–¥–∏–Ω–∏—Ü—ã —Ñ–ª–∞–∫–æ–Ω–∞">
              <button type="button" data-vialunit="mg" aria-pressed="true">–º–≥</button>
              <button type="button" data-vialunit="mcg" aria-pressed="false">–º–∫–≥</button>
            </div>
          </div>
          <div id="vial-help" class="muted" style="font-size:13px; margin:6px 0 10px">–°–∫–æ–ª—å–∫–æ –≤–µ—â–µ—Å—Ç–≤–∞ –≤–æ —Ñ–ª–∞–∫–æ–Ω–µ.</div>

          <label class="label" for="diluent">2) –û–±—ä—ë–º —Ä–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª—è (–º–ª)</label>
          <input class="input" id="diluent" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 2" min="0" step="0.01" />
          <div class="muted" style="font-size:13px; margin:6px 0 10px">–í–æ–¥–∞ –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–π –∏–ª–∏ –±–∞–∫—Ç–µ—Ä–∏–æ—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–æ–¥–∞.</div>

          <label class="label" for="dose">3) –î–æ–∑–∞ –Ω–∞ –∏–Ω—ä–µ–∫—Ü–∏—é</label>
          <div class="row">
            <input class="input" id="dose" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 2500" min="0" step="0.01" aria-describedby="dose-help" />
            <div class="seg" role="group" aria-label="–ï–¥–∏–Ω–∏—Ü—ã –¥–æ–∑—ã">
              <button type="button" data-doseunit="mg" aria-pressed="false">–º–≥</button>
              <button type="button" data-doseunit="mcg" aria-pressed="true">–º–∫–≥</button>
            </div>
          </div>
          <div id="dose-help" class="muted" style="font-size:13px">–ú–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ –º–≥ –∏–ª–∏ –º–∫–≥ (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–ø—Ä–∞–≤–∞).</div>

          <div class="btns">
            <button id="preset_5_2_2_5mg" class="btn">–ü—Ä–∏–º–µ—Ä: 5 –º–≥ ‚Üí 2 –º–ª ‚Üí 2.5 –º–≥</button>
            <button id="clear" class="btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
            <button id="copy" class="btn primary">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button id="wa" class="btn">WhatsApp</button>
            <button id="share" class="btn" aria-label="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
          </div>
          <div class="callout">–ü–æ–¥—Å–∫–∞–∑–∫–∞: U‚Äë100 ‚Äî —ç—Ç–æ 100 –µ–¥ = 1 –º–ª. –¢–æ –µ—Å—Ç—å 10 –µ–¥ = 0.1 –º–ª.</div>
        </div>

        <div>
          <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
          <div class="stats" aria-live="polite">
            <div class="stat" id="box_vol">
              <div class="k">–û–±—ä—ë–º –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–∏</div>
              <div class="v"><span id="out_ml">‚Äî</span><span class="u">–º–ª</span></div>
              <div class="muted" style="font-size:13px">U‚Äë100: <span id="out_iu">‚Äî</span> –µ–¥.</div>
            </div>
            <div class="stat" id="box_conc">
              <div class="k">–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è —Ä–∞—Å—Ç–≤–æ—Ä–∞</div>
              <div class="v"><span id="out_conc">‚Äî</span><span class="u">–º–≥/–º–ª</span></div>
              <div class="muted" style="font-size:13px">–§–æ—Ä–º—É–ª–∞: (–º–≥ –≤–æ —Ñ–ª–∞–∫–æ–Ω–µ) √∑ (–º–ª —Ä–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª—è)</div>
            </div>
            <div class="stat" id="box_doses">
              <div class="k">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∑ –∏–∑ —Ñ–ª–∞–∫–æ–Ω–∞</div>
              <div class="v"><span id="out_doses">‚Äî</span><span class="u">–¥–æ–∑</span></div>
            </div>
          </div>

          <div class="card section" style="margin-top:10px">
            <div class="row">
              <input class="input" id="u100_in" type="number" inputmode="decimal" placeholder="–ù–∞–ø—Ä., 12 –µ–¥." min="0" step="0.1" />
              <button class="btn" id="u2ml">–µ–¥ ‚Üí –º–ª</button>
              <input class="input" id="ml_in" type="number" inputmode="decimal" placeholder="–ù–∞–ø—Ä., 0.12 –º–ª" min="0" step="0.01" />
              <button class="btn" id="ml2u">–º–ª ‚Üí –µ–¥</button>
            </div>
            <div class="muted" style="font-size:13px; margin-top:6px">10 –µ–¥ = 0.1 –º–ª ¬∑ 1 –µ–¥ = 0.01 –º–ª</div>
          </div>
        </div>
      </div>
    </section>

    <section class="card section" style="margin-bottom:10px">
      <h2>–ö—É—Ä—Å –∏ –ø—Ä–∏–º–µ—Ä —Ä–∞–∑–≤–µ–¥–µ–Ω–∏—è</h2>
      <p class="muted">–ò–Ω—ä–µ–∫—Ü–∏–∏ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é, –∫–∞–∂–¥—ã–µ 7 –¥–Ω–µ–π. –ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –∫—É—Ä—Å –∏–∑ –¢–ó, –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–µ–¥–µ–ª–∏, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å CSV/JSON –∏ –¥–æ–±–∞–≤–∏—Ç—å –±–ª–∏–∂–∞–π—à–∏–µ –¥–∞—Ç—ã.</p>
      <div class="btns" style="margin-bottom:8px">
        <button id="insertClientCourse" class="btn">–í—Å—Ç–∞–≤–∏—Ç—å –∫—É—Ä—Å –∏–∑ –¢–ó</button>
        <button id="normalizeCourse" class="btn">–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–µ–¥–µ–ª–∏</button>
        <button id="addDates" class="btn">–ü—Ä–æ—Å—Ç–∞–≤–∏—Ç—å –¥–∞—Ç—ã</button>
        <button id="exportCourse" class="btn primary">–°–∫–∞—á–∞—Ç—å CSV</button>
        <button id="exportJSON" class="btn">–°–∫–∞—á–∞—Ç—å JSON</button>
      </div>
      <ul id="course" class="muted" style="margin-left:18px"></ul>
    </section>

    <section class="card section" style="margin-bottom:10px">
      <div class="row" style="justify-content:space-between; align-items:center">
        <h2 style="margin:0">–ò—Å—Ç–æ—Ä–∏—è</h2>
        <div class="btns" style="margin:0">
          <button id="exportHistory" class="btn">–≠–∫—Å–ø–æ—Ä—Ç</button>
          <label class="btn" for="importFile" style="cursor:pointer">–ò–º–ø–æ—Ä—Ç</label>
          <input id="importFile" type="file" accept="application/json" class="sr" />
          <button id="clearHistory" class="btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
      <div class="muted" style="font-size:13px; margin:6px 0 10px">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 12 —Ä–∞—Å—á—ë—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –≤—ã–≥—Ä—É–∑–∏—Ç—å/–∑–∞–≥—Ä—É–∑–∏—Ç—å.</div>
      <div class="tablewrap">
        <table id="history">
          <thead><tr><th>–î–∞—Ç–∞</th><th>–§–ª–∞–∫–æ–Ω</th><th>–†–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª—å</th><th>–î–æ–∑–∞</th><th>–ö–æ–Ω—Ü.</th><th>–û–±—ä—ë–º</th><th>U‚Äë100</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="card section" style="margin-bottom:10px">
      <h2>–ü–∞–º—è—Ç–∫–∞ –∏ FAQ</h2>
      <div class="acc" style="margin-top:8px">
        <div class="item">
          <button class="head" aria-expanded="false"><span>–•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∏–Ω—ä–µ–∫—Ü–∏–∏</span><span class="icon">+</span></button>
          <div class="body"><div class="inner">
            <ul style="margin:6px 0 0 18px">
              <li>–•—Ä–∞–Ω–∏—Ç—å –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ (+2‚Ä¶+8¬∞C), –Ω–µ –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—Ç—å.</li>
              <li>–†–∞–∑–≤–æ–¥–∏—Ç—å –≤–æ–¥–æ–π –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–π –∏–ª–∏ –±–∞–∫—Ç–µ—Ä–∏–æ—Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–æ–¥–æ–π.</li>
              <li>–ò–Ω—ä–µ–∫—Ü–∏–∏ ‚Äî –ø–æ–¥–∫–æ–∂–Ω–æ (–∂–∏–≤–æ—Ç), —à–ø—Ä–∏—Ü U‚Äë100.</li>
              <li>–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å—á–∏—Ç–∞–π—Ç–µ –¥–æ–∑–∏—Ä–æ–≤–∫—É, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫ –ø–æ–±–æ—á–µ–∫.</li>
            </ul>
          </div></div>
        </div>
        <div class="item">
          <button class="head" aria-expanded="false"><span>–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –º–≥ –æ—Ç –º–∫–≥?</span><span class="icon">+</span></button>
          <div class="body"><div class="inner">1 –º–≥ = 1000 –º–∫–≥. –í –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ –µ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –µ–¥–∏–Ω–∏—Ü –¥–ª—è —Ñ–ª–∞–∫–æ–Ω–∞ –∏ –¥–æ–∑—ã.</div></div>
        </div>
        <div class="item">
          <button class="head" aria-expanded="false"><span>–ú–æ–∂–Ω–æ –ª–∏ –æ—Ñ–ª–∞–π–Ω?</span><span class="icon">+</span></button>
          <div class="body"><div class="inner">–î–∞. –ù–∞–∂–º–∏—Ç–µ ¬´–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å¬ª –≤ —à–∞–ø–∫–µ ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (PWA).</div></div>
        </div>
      </div>
      <div class="callout"><strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –Ω–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è. –ü–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.</div>
    </section>

    <div class="dock">
      <div class="bar">
        <button id="quickPreset" class="btn">5 –º–≥ ‚Üí 2 –º–ª</button>
        <button id="quickCopy" class="btn primary">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
    </div>
  </main>

  <script>
    (function(){
      const $ = (s, r=document) => r.querySelector(s);
      const $$ = (s, r=document) => r.querySelectorAll(s);
      const st = { vialUnit:'mg', doseUnit:'mcg' };
      const LS_KEY = 'nef_pep_calc_v3';
      const HIST_KEY = 'nef_pep_hist_v1';

      const vial = $('#vial');
      const diluent = $('#diluent');
      const dose = $('#dose');
      const out_ml = $('#out_ml');
      const out_iu = $('#out_iu');
      const out_conc = $('#out_conc');
      const out_doses = $('#out_doses');

      function fmt(n, p=3){ return Number.isFinite(n) ? Number(n).toFixed(p) : '‚Äî'; }
      function pulse(id){ const el=$('#'+id); if(!el) return; el.classList.remove('pulse'); void el.offsetWidth; el.classList.add('pulse'); }

      function toMg(val, unit){ if(!Number.isFinite(val)) return NaN; return unit==='mcg' ? val/1000 : val; }
      function toMcg(val, unit){ if(!Number.isFinite(val)) return NaN; return unit==='mg' ? val*1000 : val; }

      function calc(){
        const vialVal = parseFloat(vial.value);
        const dilVal = parseFloat(diluent.value);
        const doseVal = parseFloat(dose.value);

        const vialMg = toMg(vialVal, st.vialUnit);
        const doseMg = toMg(doseVal, st.doseUnit);

        if(!(vialMg>0) || !(dilVal>0)){
          out_conc.textContent = '‚Äî'; out_ml.textContent = '‚Äî'; out_iu.textContent = '‚Äî'; out_doses.textContent = '‚Äî';
          return;
        }

        const conc = vialMg / dilVal; // –º–≥/–º–ª
        out_conc.textContent = fmt(conc,3); pulse('box_conc');

        if(!(doseMg>0)){
          out_ml.textContent = '‚Äî'; out_iu.textContent = '‚Äî'; out_doses.textContent = '‚Äî';
          return;
        }

        const volMl = doseMg / conc; // –º–ª
        const iu = volMl * 100; // U‚Äë100
        const dosesCount = Math.floor((vialMg * 1000) / (doseMg * 1000));

        out_ml.textContent = fmt(volMl,3); pulse('box_vol');
        out_iu.textContent = fmt(iu,1);
        out_doses.textContent = String(dosesCount);

        addToHistory({
          ts: Date.now(),
          vial: vial.value + ' ' + st.vialUnit,
          diluent: diluent.value + ' –º–ª',
          dose: dose.value + ' ' + st.doseUnit,
          conc: fmt(conc,3)+' –º–≥/–º–ª',
          vol: fmt(volMl,3)+' –º–ª',
          iu: fmt(iu,1)+' –µ–¥'
        });
      }

      function save(){
        const data = {vial:vial.value, diluent:diluent.value, dose:dose.value, vialUnit:st.vialUnit, doseUnit:st.doseUnit, theme:document.documentElement.dataset.theme};
        try{ localStorage.setItem(LS_KEY, JSON.stringify(data)); }catch(e){}
      }
      function load(){
        try{ const d = JSON.parse(localStorage.getItem(LS_KEY)||'{}');
          if(d.vial) vial.value = d.vial;
          if(d.diluent) diluent.value = d.diluent;
          if(d.dose) dose.value = d.dose;
          if(d.vialUnit){ st.vialUnit = d.vialUnit; $$('[data-vialunit]').forEach(b=>b.setAttribute('aria-pressed', b.dataset.vialunit===st.vialUnit? 'true':'false')); }
          if(d.doseUnit){ st.doseUnit = d.doseUnit; $$('[data-doseunit]').forEach(b=>b.setAttribute('aria-pressed', b.dataset.doseunit===st.doseUnit? 'true':'false')); }
          if(d.theme){ document.documentElement.dataset.theme = d.theme; $('#theme').textContent = d.theme==='light' ? '‚òÄÔ∏è' : 'üåô'; }
        }catch(e){}
      }

      // Unit toggles
      $$('[data-vialunit]').forEach(b=>b.addEventListener('click', ()=>{ $$('[data-vialunit]').forEach(x=>x.setAttribute('aria-pressed','false')); b.setAttribute('aria-pressed','true'); st.vialUnit=b.dataset.vialunit; calc(); save(); }));
      $$('[data-doseunit]').forEach(b=>b.addEventListener('click', ()=>{ $$('[data-doseunit]').forEach(x=>x.setAttribute('aria-pressed','false')); b.setAttribute('aria-pressed','true'); st.doseUnit=b.dataset.doseunit; calc(); save(); }));

      // Inputs
      [vial,diluent,dose].forEach(i=> i.addEventListener('input', ()=>{ calc(); save(); }));

      // Preset
      const preset = ()=>{ vial.value=5; st.vialUnit='mg'; $$('[data-vialunit]').forEach(x=>x.setAttribute('aria-pressed', x.dataset.vialunit==='mg'?'true':'false'));
                           diluent.value=2; dose.value=2.5; st.doseUnit='mg'; $$('[data-doseunit]').forEach(x=>x.setAttribute('aria-pressed', x.dataset.doseunit==='mg'?'true':'false')); calc(); save(); };
      $('#preset_5_2_2_5mg').addEventListener('click', preset);
      $('#quickPreset').addEventListener('click', preset);

      // Clear / Copy / Share / WhatsApp
      const getResultText = ()=> `–ö–æ–Ω—Ü.: ${out_conc.textContent} –º–≥/–º–ª; –û–±—ä—ë–º: ${out_ml.textContent} –º–ª (‚âà ${out_iu.textContent} U‚Äë100); –î–æ–∑ –∏–∑ —Ñ–ª–∞–∫–æ–Ω–∞: ${out_doses.textContent}.`;
      const notify = (msg='–ì–æ—Ç–æ–≤–æ')=>{ const t=document.createElement('div'); t.textContent=msg; t.style.position='fixed'; t.style.bottom='18px'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.background='var(--primary)'; t.style.color='#fff'; t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.boxShadow='var(--shadow)'; t.style.zIndex='1000'; t.style.opacity='0'; t.style.transition='opacity .2s, transform .2s'; document.body.appendChild(t); requestAnimationFrame(()=>{t.style.opacity='1'}); setTimeout(()=>{t.style.opacity='0'; t.style.transform='translateX(-50%) translateY(6px)'; setTimeout(()=>t.remove(),220)}, 1500); };
      $('#clear').addEventListener('click', ()=>{ [vial,diluent,dose].forEach(i=>i.value=''); calc(); save(); notify('–û—á–∏—â–µ–Ω–æ'); });
      $('#copy').addEventListener('click', async()=>{ try{ await navigator.clipboard.writeText(getResultText()); notify('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'); }catch(e){ notify('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'); } });
      $('#quickCopy').addEventListener('click', async()=>{ try{ await navigator.clipboard.writeText(getResultText()); notify('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'); }catch(e){ notify('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è'); } });
      $('#share').addEventListener('click', async()=>{ const text=getResultText(); if(navigator.share){ try{ await navigator.share({title:'–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–µ–ø—Ç–∏–¥–æ–≤', text}); notify('–ü–æ–¥–µ–ª–∏–ª–∏—Å—å'); }catch(e){} } else { try{ await navigator.clipboard.writeText(text); notify('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'); }catch(e){ notify('–ù–µ—Ç Share/Clipboard'); } }});
      $('#wa').addEventListener('click', ()=>{ const url = 'https://wa.me/?text='+encodeURIComponent(getResultText()); window.open(url, '_blank'); });

      // Course (client-provided list with duplicates)
      const CLIENT = [
        ['–ù–µ–¥–µ–ª—è 1','2,5–º–≥'], ['–ù–µ–¥–µ–ª—è 2','2,5–º–≥'], ['–ù–µ–¥–µ–ª—è 3','2,5–º–≥'], ['–ù–µ–¥–µ–ª—è 4','2,5–º–≥'],
        ['–ù–µ–¥–µ–ª—è 5','5–º–≥'], ['–ù–µ–¥–µ–ª—è 6','5–º–≥'], ['–ù–µ–¥–µ–ª—è 7','5–º–≥'], ['–ù–µ–¥–µ–ª—è 8','5–º–≥'],
        ['–ù–µ–¥–µ–ª—è 9','7,5–º–≥'], ['–ù–µ–¥–µ–ª—è 10','7,5–º–≥'], ['–ù–µ–¥–µ–ª—è 12','7,5–º–≥'],
        ['–ù–µ–¥–µ–ª—è 10','10–º–≥'], ['–ù–µ–¥–µ–ª—è 11','10–º–≥'], ['–ù–µ–¥–µ–ª—è 12','10–º–≥'], ['–ù–µ–¥–µ–ª—è 14','10–º–≥'],
      ];
      const list = $('#course');
      function render(arr){ list.innerHTML=''; arr.forEach(([w,d])=>{ const li=document.createElement('li'); li.style.margin='6px 0'; li.innerHTML = `<strong>${w}:</strong> ${d}`; list.appendChild(li); }); }
      $('#insertClientCourse').addEventListener('click', ()=>{ render(CLIENT); notify('–ö—É—Ä—Å –≤—Å—Ç–∞–≤–ª–µ–Ω'); });
      $('#normalizeCourse').addEventListener('click', ()=>{ const doses = (list.children.length? [...list.children].map(li=>li.textContent.split(':')[1].trim()) : CLIENT.map(x=>x[1])); const norm = doses.map((d,i)=>[`–ù–µ–¥–µ–ª—è ${i+1}`, d]); render(norm); notify('–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ'); });
      $('#exportCourse').addEventListener('click', ()=>{ if(!list.children.length) render(CLIENT); const rows = [...list.children].map(li=>{ const [w,rest] = li.textContent.split(':'); return [w.trim(), rest.trim()]; }); const csv = [['–ù–µ–¥–µ–ª—è','–î–æ–∑–∞'], ...rows].map(r=>r.map(x=>`"${String(x).replaceAll('"','""')}"`).join(',')).join('\n'); const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='tirzepatide_course.csv'; a.click(); URL.revokeObjectURL(url); });
      $('#exportJSON').addEventListener('click', ()=>{ const rows = [...list.children].map(li=>{ const [w,rest] = li.textContent.split(':'); return {week:w.trim(), dose:rest.trim()}; }); const blob = new Blob([JSON.stringify(rows,null,2)], {type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='tirzepatide_course.json'; a.click(); URL.revokeObjectURL(url); });
      $('#addDates').addEventListener('click', ()=>{ const start = new Date(); if(!list.children.length) render(CLIENT); [...list.children].forEach((li,idx)=>{ const d = new Date(start.getTime() + idx*7*24*3600*1000); const dd = d.toLocaleDateString('ru-RU'); if(!/\(\d{2}\.\d{2}\.\d{4}\)$/.test(li.textContent)) li.textContent += ` (${dd})`; }); });

      // Accordion
      $$('.acc .item').forEach(item=>{ const head = $('.head', item); const body = $('.body', item); head.addEventListener('click', ()=>{ const open = item.classList.toggle('active'); head.setAttribute('aria-expanded', String(open)); body.style.maxHeight = open ? body.scrollHeight+'px' : 0; }); });

      // Theme toggle
      $('#theme').addEventListener('click', ()=>{ const cur = document.documentElement.dataset.theme; const next = cur==='light'?'dark':'light'; document.documentElement.dataset.theme = next; $('#theme').textContent = next==='light' ? '‚òÄÔ∏è' : 'üåô'; save(); });

      // Quick U100 converter
      $('#u2ml').addEventListener('click', ()=>{ const v=parseFloat($('#u100_in').value); if(Number.isFinite(v)){ $('#ml_in').value = (v*0.01).toFixed(2); notify('–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –≤ –º–ª'); }});
      $('#ml2u').addEventListener('click', ()=>{ const v=parseFloat($('#ml_in').value); if(Number.isFinite(v)){ $('#u100_in').value = (v*100).toFixed(1); notify('–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –≤ –µ–¥'); }});

      // History
      function getHist(){ try{ return JSON.parse(localStorage.getItem(HIST_KEY)||'[]'); }catch(e){ return []; } }
      function setHist(arr){ try{ localStorage.setItem(HIST_KEY, JSON.stringify(arr.slice(-12))); }catch(e){} }
      function addToHistory(rec){ if(!rec || !Number.isFinite(Date.parse(new Date(rec.ts)))) return; const arr=getHist(); arr.push(rec); setHist(arr); renderHist(); }
      function renderHist(){ const body=$('#history tbody'); const arr=getHist().slice().reverse(); body.innerHTML=''; arr.forEach(r=>{ const tr=document.createElement('tr'); const dt=new Date(r.ts).toLocaleString('ru-RU'); tr.innerHTML=`<td>${dt}</td><td>${r.vial}</td><td>${r.diluent}</td><td>${r.dose}</td><td>${r.conc}</td><td>${r.vol}</td><td>${r.iu}</td>`; body.appendChild(tr); }); }
      $('#clearHistory').addEventListener('click', ()=>{ setHist([]); renderHist(); notify('–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞'); });
      $('#exportHistory').addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify(getHist(),null,2)], {type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='nef_calculator_history.json'; a.click(); URL.revokeObjectURL(url); });
      $('#importFile').addEventListener('change', (e)=>{ const f=e.target.files?.[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ const arr=JSON.parse(r.result); if(Array.isArray(arr)){ setHist(arr); renderHist(); notify('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ'); } }catch(err){ notify('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞'); } }; r.readAsText(f); });

      // PWA minimal (in-page service worker via Blob)
      let deferredPrompt=null; window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; $('#install').disabled=false; });
      $('#install').addEventListener('click', async()=>{ if(deferredPrompt){ deferredPrompt.prompt(); try{ await deferredPrompt.userChoice; }catch{} deferredPrompt=null; } else { notify('–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: –¥–æ–±–∞–≤—å—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –∏–∑ –º–µ–Ω—é –±—Ä–∞—É–∑–µ—Ä–∞.'); } });
      // Register SW (cache this page + assets)
      try{
        const swCode = `self.addEventListener('install',e=>{e.waitUntil(caches.open('nef-cache-v1').then(c=>c.addAll(['./'])))}); self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))})`;
        const swBlob = new Blob([swCode], {type:'text/javascript'});
        const swUrl = URL.createObjectURL(swBlob);
        if('serviceWorker' in navigator){ navigator.serviceWorker.register(swUrl); }
      }catch(e){}

      // Init
      load();
      if(!vial.value && !diluent.value && !dose.value){ preset(); }
      calc();
      renderHist();
      document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) calc(); });

      // Save on exit
      window.addEventListener('beforeunload', save);
    })();
  </script>
</body>
</html>